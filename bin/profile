#!/bin/bash


CURRDIR="$(pwd)"
PROJECT_LOCATION="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && cd .. && pwd )"
export PYTHONPATH="${PROJECT_LOCATION}/stockExperiments"

profile() {
	local PSTATSFILE IMGFILE
	PSTATSFILE="profile/profile.pstats"
	IMGFILE="profile/profile.png"
	#IMGFILE="profile/profile_$(date +%F_%T | sed 's/[\s:]//g').png"

	mkdir -p "profile"
	python -m cProfile -s cumulative -o "${PSTATSFILE}" stockExperiments/experiments.py
	python bin/util/gprof2dot.py -f pstats "${PSTATSFILE}" | dot -Tpng -o "${IMGFILE}"
	python bin/util/displayprofilestats.py "${PSTATSFILE}"
}

cd "${PROJECT_LOCATION}"
profile
find . -type f -name "*.pyc" -exec rm -f {} \;
cd "${CURRDIR}"
